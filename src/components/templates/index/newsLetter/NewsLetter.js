"use client";
import React, { useState } from "react";
import styles from "../../../modules/footer/Footer.module.css";
import Loading from "@/app/loading";
import { swalAlert, toastError, toastSuccess } from "@/utils/alerts";
import { validateEmail } from "@/utils/auth";

function NewsLetter() {
  const [email, setEmail] = useState("");
  const [isLoading, setIsLoading] = useState(false);

  const registerEmail = async (event) => {
    event.preventDefault();

    if (!email) {
      setIsLoading(false);
      return swalAlert("لطفا ایمیل خود را وارد نمایید", "error", "فهمیدم");
    }

    const isValidEmail = validateEmail(email);
    if (!isValidEmail) {
      setIsLoading(false);
      return swalAlert("لطفا ایمیل معتبر وارد نمایید", "error", "فهمیدم");
    }

    const newsEmail = { email };

    const res = await fetch("/api/news", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(newsEmail),
    });

    console.log(res);

    if (res.status === 201) {
      setEmail("");
      setIsLoading(false);
      toastSuccess(
        "ایمیل با موفقیت ثبت شد. خبر های مهم را از طریق ایمیل خود پیگیری نمایید",
        "bottom-center",
        5000,
        false,
        true,
        true,
        true,
        undefined,
        "colored"
      );
    } else if (res.status === 400) {
      setEmail("");
      setIsLoading(false);
      toastError(
        "لطفا ایمیل خود را وارد نمایید",
        "top-center",
        5000,
        false,
        true,
        true,
        true,
        undefined,
        "colored"
      );
    } else if (res.status === 419) {
      setEmail("");
      setIsLoading(false);
      toastError(
        "ایمیل ثبت شده است",
        "bottom-center",
        5000,
        false,
        true,
        true,
        true,
        undefined,
        "colored"
      );
    } else if (res.status === 422) {
      setEmail("");
      setIsLoading(false);
      toastError();
      toastError(
        "لطفا ایمیل معتبر وارد نمایید",
        "top-center",
        5000,
        false,
        true,
        true,
        true,
        undefined,
        "colored"
      );
    } else if (res.status === 500) {
      setEmail("");
      setIsLoading(false);
      toastError(
        "خطا در سرور لطفا پس از چند دقیقه دوباره تلاش نمایید",
        "top-center",
        5000,
        false,
        true,
        true,
        true,
        undefined,
        "colored"
      );
    }
  };

  return (
    <div className="col-md-6 col-lg-4">
      <div className={styles.widget}>
        <h4 className={styles.widgetTitle}>عضویت در خبرنامه</h4>
        <p>
          برای دریافت جدیدترین دستورپخت‌ها و تخفیف‌های ویژه، ایمیل خود را وارد
          کنید.
        </p>
        <form className={styles.newsletterForm}>
          <div className="input-group">
            <input
              type="email"
              className={`form-control ${styles.newsletterInput}`}
              placeholder="آدرس ایمیل شما"
              value={email}
              onChange={(event) => setEmail(event.target.value)}
            />
            <button
              className={styles.newsletterButton}
              type="submit"
              onClick={(event) => {
                setIsLoading(true);
                registerEmail(event);
              }}
            >
              {isLoading ? <Loading /> : "عضویت"}
            </button>
          </div>
        </form>
        <div className={styles.socialLinks}>
          <a href="#" title="Instagram">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z" />
            </svg>
          </a>
          <a href="#" title="Telegram">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.894 8.221l-1.97 9.28c-.145.658-.537.818-1.084.508l-3-2.21-1.446 1.394c-.14.18-.357.295-.6.295-.002 0-.003 0-.005 0l.213-3.054 5.56-5.022c.24-.213-.054-.334-.373-.121l-6.869 4.326-2.96-.924c-.64-.203-.658-.64.135-.954l11.566-4.458c.538-.196 1.006.128.832.941z" />
            </svg>
          </a>
          <a href="#" title="WhatsApp">
            <svg width="24" height="24" viewBox="0 0 24 24">
              <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6.99 6.98l-2.52 2.51c-.566.566-1.109 1.184-1.673 1.773-.444.48-.905.968-1.424 1.384-.486.389-.981.708-1.606.772-.602.062-1.205.006-1.808-.011-.445-.012-.893-.025-1.34-.039-.572-.019-1.215.241-1.405.799-.191.558-.111 1.072.25 1.578.24.336.551.637.872.918.292.255.59.504.885.745 1.616 1.302 3.438 2.191 5.471 1.382 1.624-.642 2.732-2.278 2.93-3.999.2-1.782-.355-3.59-1.213-5.03-.931-1.546-2.254-2.738-3.934-3.397-1.696-.666-3.644-.585-5.298.213-1.661.803-2.876 2.247-3.468 3.992-.584 1.7-.399 3.61.507 5.201.89 1.566 2.347 2.765 4.004 3.497.853.382 1.758.573 2.671.653.6.053 1.213.057 1.821.02.559-.034 1.126-.116 1.675-.248 1.417-.341 2.367-1.615 2.367-3.104 0-.445-.083-.901-.28-1.317l-.498-1.378c-.172-.476-.439-.93-.773-1.316-.665-.77-1.616-1.147-2.56-1.108-.848.033-1.694.227-2.444.579-.529.244-1.006.589-1.446.963-.096.083-.192.167-.279.256-.434.444-.605.967-.566 1.54.041.537.296 1.044.691 1.389.277.244.59.42.928.52.338.098.688.119 1.038.047.368-.075.701-.25.981-.498.256-.224.474-.488.654-.775.21-.338.374-.701.51-1.078.151-.417.327-.834.546-1.225.209-.377.476-.72.795-1.001.356-.318.781-.549 1.238-.675.464-.127.95-.137 1.421-.028.471.109.912.326 1.284.634.343.281.637.614.867.978.229.363.398.76.497 1.175.09.382.12.774.089 1.165-.031.39-.122.776-.27 1.144-.148.367-.352.71-.604 1.016-.251.306-.548.572-.88.788-.332.216-.695.38-1.076.487-.381.107-.776.156-1.172.146-.396-.01-.79-.077-1.167-.202-.376-.124-.732-.308-1.054-.545-.322-.237-.606-.524-.84-.849-.234-.325-.416-.685-.538-1.068-.123-.383-.184-.784-.182-1.187.002-.403.068-.804.197-1.186.129-.382.32-.74.566-1.062.247-.322.546-.604.886-.832.34-.228.718-.4 1.117-.509.399-.109.814-.154 1.229-.133.415.021.826.107 1.217.255.39.148.755.357 1.08.618.325.261.607.57.835.914.228.344.4.719.511 1.112.111.394.16.802.146 1.21-.014.408-.091.813-.229 1.2-.138.388-.335.753-.583 1.083-.248.33-.544.621-.878.863-.333.242-.701.432-1.09.563-.389.131-.795.202-1.205.21-.41.008-.82-.046-1.216-.161-.397-.115-.774-.29-1.117-.519-.343-.229-.648-.51-.904-.832-.256-.322-.46-.683-.604-1.068-.144-.385-.226-.79-.242-1.2-.016-.41.034-.82.146-1.216.112-.397.284-.775.511-1.118.227-.343.506-.653.83-.914.324-.261.687-.473 1.075-.623.388-.149.796-.237 1.209-.26.413-.023.825.022 1.223.129.398.107.775.276 1.115.502.34.226.637.505.885.825.248.32.44.675.57 1.054.13.379.198.78.2 1.183.002.403-.06.803-.185 1.186-.125.383-.309.744-.545 1.071-.236.327-.524.616-.848.855-.324.239-.68.426-1.058.553-.378.127-.773.193-1.171.196-.398.003-.795-.052-1.176-.165z" />
            </svg>
          </a>
        </div>
      </div>
    </div>
  );
}

export default NewsLetter;
